<script type="module">
  import C from '../ceres.js';
  window.C = C;

  window.clickValue = ''

  const suite = [
    'identity',
    'default invocation',
    'default svg invocation',
    'default math invocation',
    'string parsing tag, id, class',
    'string parsing class',
    'string parsing id',
    'attribute',
    'svg attributes',
    'nested div with event handler',
    'styled by string',
    'styled by object',
    'declared attributes',
    'dynamic content',
    'dynamic browser function',
    'parseable static, non string content'
  ]

  const tests = [
    () => C,
    () => C(),
    () => C.svg(),
    () => C.math(),
    () => C('span#nothing.burger'),
    () => C('.hello'),
    () => C('#goodbye'),
    () => C('a', { href: 'hello' }),
    () => C.svg('g', {x: 10, y: 10}),
    () => C('div', [C('div'), C('span'), 'hello'], 'hello', {onclick: function() { window.clickValue = 'hello' }}),
    () => C('span', { style: 'color: blue' }),
    () => C('span', {style: { color: 'blue' }}),
    () => C.html('p', { attrs: { mysterious: 'mushroom'}}),
    () => C('div', () => Date.now()),
    () => C('div', Date.now),
    () => C('div', Date.now())
  ]

  const assertions = [
    (a) => a === C,
    (a) => a.tagName === document.createElement('div').tagName,
    (a) => a.tagName === document.createElementNS('http://www.w3.org/2000/svg', 'svg').tagName,
    (a) => a.tagName === document.createElementNS('http://www.w3.org/1998/Math/MathML', 'math').tagName,
    (a) => {
      return a.tagName === document.createElement('span').tagName &&
        a.id === 'nothing' &&
        Array.from(a.classList).includes('burger')
    },
    (a) => a.tagName === document.createElement('div').tagName && Array.from(a.classList).includes('hello'),
    (a) => a.tagName === document.createElement('div').tagName && a.id === 'goodbye',
    (a) => a.tagName === document.createElement('a').tagName && (new URL(a.href)).pathname === '/hello',
    (a) => a.getAttribute('x') === '10' && a.getAttribute('y') === '10',
    (a) => {
      a.click()
      return a.children.length === 2 &&
        a.childNodes.length === 4 &&
        a.textContent === 'hellohello' &&
        window.clickValue === 'hello'
    },
    (a) => a.style['color'] === 'blue',
    (a) => a.style['color'] === 'blue',
    (a) => a.getAttribute('mysterious') === 'mushroom',
    (a) => !isNaN(a.textContent),
    (a) => !isNaN(a.textContent),
    (a) => !isNaN(a.textContent)
  ]

  suite.forEach((slug, i) => {
    try {
      const q = tests[i]()
      const s = assertions[i](q)

      //if (i===1) debugger;

      console.assert(s, {test: i, slug: slug, received: q})
      if (s) console.log(`%ctest ${i} SUCCESS ${String.fromCodePoint(0x2705)} ${slug}`, 'color: lightgreen;')
    } catch(e) {
      console.error(`%ctest ${i} ERROR ${String.fromCodePoint(0x274c)} ${slug} ${e}`, 'color: red')
    }
  })
</script>
